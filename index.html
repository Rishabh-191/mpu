<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>MPU6050 3D Viewer</title>
  <style>
    body { margin: 0; overflow: hidden; background: #000; }
    canvas { display: block; }
  </style>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/three.js/r128/three.min.js"></script>
</head>
<body>
<script>
  const scene = new THREE.Scene();
  const camera = new THREE.PerspectiveCamera(75, window.innerWidth / window.innerHeight, 0.1, 1000);
  const renderer = new THREE.WebGLRenderer({ antialias: true });
  renderer.setSize(window.innerWidth, window.innerHeight);
  document.body.appendChild(renderer.domElement);

  const geometry = new THREE.BoxGeometry(1, 1, 1);
  const material = new THREE.MeshNormalMaterial();
  const cube = new THREE.Mesh(geometry, material);
  scene.add(cube);

  camera.position.z = 4;

  function animate() {
    requestAnimationFrame(animate);
    renderer.render(scene, camera);
  }
  animate();

  // WebSocket connection
  const socket = new WebSocket('ws://localhost:6789');

  socket.onopen = () => {
    console.log("✅ WebSocket connected");
  };

  socket.onmessage = function(event) {
    try {
      const data = event.data.trim().split(',').map(Number);
      if (data.length === 6 && data.every(n => !isNaN(n))) {
        const [gx, gy, gz] = data;

        // Scale to adjust sensitivity
        const factor = 0.001;
        cube.rotation.x += gx * factor;
        cube.rotation.y += gy * factor;
        cube.rotation.z += gz * factor;
      }
    } catch (err) {
      console.error("Invalid data:", event.data, err);
    }
  };

  socket.onerror = (err) => {
    console.error("WebSocket error:", err);
  };

  socket.onclose = () => {
    console.warn("⚠️ WebSocket connection closed");
  };
</script>
</body>
</html>
